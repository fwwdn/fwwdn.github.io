<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Redis缓存使用优化［译］ | fwwdn&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="原文：http://sorentwo.com/2015/07/27/optimizing-redis-usage-for-caching.html?utm_source=redisweekly&amp;amp;utm_medium=email
如果你和我一样认为Redis是一个合适的cache工具，那么，通过下面的内容你将学到4个有效的方法来优化Redis作为你的基础缓存设施。即使你使用托管的解决方案，下">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis缓存使用优化［译］">
<meta property="og:url" content="http://yoursite.com/2015/08/02/Optimizing-Redis-Usage-For-Caching/index.html">
<meta property="og:site_name" content="fwwdn's blog">
<meta property="og:description" content="原文：http://sorentwo.com/2015/07/27/optimizing-redis-usage-for-caching.html?utm_source=redisweekly&amp;amp;utm_medium=email
如果你和我一样认为Redis是一个合适的cache工具，那么，通过下面的内容你将学到4个有效的方法来优化Redis作为你的基础缓存设施。即使你使用托管的解决方案，下">
<meta property="og:updated_time" content="2015-08-03T02:59:48.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Redis缓存使用优化［译］">
<meta name="twitter:description" content="原文：http://sorentwo.com/2015/07/27/optimizing-redis-usage-for-caching.html?utm_source=redisweekly&amp;amp;utm_medium=email
如果你和我一样认为Redis是一个合适的cache工具，那么，通过下面的内容你将学到4个有效的方法来优化Redis作为你的基础缓存设施。即使你使用托管的解决方案，下">
  
    <link rel="alternative" href="/atom.xml" title="fwwdn&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="/img/me.png" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">fwwdn</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/tags/随笔">随笔</a></li>
				        
							<li><a href="/tags/相册">相册</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/fwwdn" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/u/1713855955/home?wvr=5" title="weibo">weibo</a>
					        
								<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/fwwdn" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/NoSQL/" style="font-size: 10px;">NoSQL</a> <a href="/tags/NoSQL-Redis/" style="font-size: 10px;">NoSQL Redis</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Tools/" style="font-size: 20px;">Tools</a> <a href="/tags/java/" style="font-size: 16.67px;">java</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/后端技术/" style="font-size: 10px;">后端技术</a> <a href="/tags/收藏/" style="font-size: 13.33px;">收藏</a> <a href="/tags/架构/" style="font-size: 13.33px;">架构</a> <a href="/tags/电商/" style="font-size: 10px;">电商</a> <a href="/tags/随笔/" style="font-size: 13.33px;">随笔</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://dbanotes.net/">冯大辉</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">随身云后端开发，关注的技术：Linux、java、memcached、redis,、mysql、 solr。</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">fwwdn</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/me.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">fwwdn</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/tags/随笔">随笔</a></li>
		        
					<li><a href="/tags/相册">相册</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/fwwdn" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/u/1713855955/home?wvr=5" title="weibo">weibo</a>
			        
						<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/fwwdn" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-Optimizing-Redis-Usage-For-Caching" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/08/02/Optimizing-Redis-Usage-For-Caching/" class="article-date">
  	<time datetime="2015-08-02T09:29:50.000Z" itemprop="datePublished">2015-08-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Redis缓存使用优化［译］
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Redis/">Redis</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>原文：<a href="http://sorentwo.com/2015/07/27/optimizing-redis-usage-for-caching.html?utm_source=redisweekly&amp;utm_medium=email" target="_blank" rel="external">http://sorentwo.com/2015/07/27/optimizing-redis-usage-for-caching.html?utm_source=redisweekly&amp;utm_medium=email</a></p>
<p>如果你和我一样认为Redis是一个合适的cache工具，那么，通过下面的内容你将学到4个有效的方法来优化Redis作为你的基础缓存设施。即使你使用托管的解决方案，下面的优化方法仍然是有帮助的。</p>
<h2 id="使用专用的缓存实例">使用专用的缓存实例</h2><p>Redis不像Memcached一样是多线程机制，它是单进程单线程的。考虑到Redis的处理速度，以及它要处理的工作量，如果你使用单实例配置，当你的平台的流量开始上升，需要处理的后台任务持续增加，发布/订阅频道转发超过数以千计的网络负载，缓存命中率持续增加时，就会有大量的Redis请求被阻塞，这时，Redis只能通过丢弃一些后台任务或是增加一组负载均衡服务器来解决当前的瓶颈。</p>
<p>使用多个独立实例的配置，可以缓解单实例的压力。多个实例：一个用于后台任务，一个用于发布/订阅，另外一个专门用于缓存。不要依赖将数据分割成多个redis数据库！因为这些数据库后面仍然只有一个处理进程，所有上面的警告依然适用。</p>
<h4 id="总结下:">总结下:</h4><ul>
<li>对不同的工作负载使用专用的Redis实例；</li>
<li>不要使用数据库（/ 0，/ 1，/ 2）来分区工作负载。</li>
</ul>
<h2 id="放宽持久化策略">放宽持久化策略</h2><blockquote>
<p>你应该关注持久化和复制这两个Redis特性，即使你的目标只是建立一个缓存，这两个特性有助于当你升级或重启后，你的数据仍然不会丢失。</p>
<p>—Antirez</p>
</blockquote>
<p>Each Redis instance has its own configuration file and can be tuned according to the use-case. Caching servers, for example, can be configured to use RDB persistence to periodically save a single backup instead of AOF persistence logs. By only taking periodic snapshots of the database RDB maximizes performance at the expense of up-to-the-second consistency. For a hybrid Redis instance that may be storing business critical background jobs data consistency is paramount. With a cache it is alright to lose some data in the event of a disaster, after reboot most of the cache will be warm and intact.</p>
<h4 id="总结下:-1">总结下:</h4><p>Do optimize cache persistence speed by favoring RDB over AOF.<br>Do set stop-writes-on-bgsave-error to no to prevent all writes from failing when snapshotting fails. This requires proper monitoring and alerts for failures, which you are doing anyhow, right?<br>Do not disable persistence entirely, it is valuable for warming the cache after an upgrade or restart.</p>
<h2 id="有效管理内存">有效管理内存</h2><p>Once you have a Redis instance dedicated to caching you can start to optimize memory management in ways that don’t make sense for a hybrid database. When ephemeral and long-lived data is co-mingled it is imperative that ephemeral keys have a TTL and Redis is free to clean up expired keys.</p>
<p>Redis can manage memory in a variety of ways. The management policies vary from never evicting keys (noeviction) to randomly evicting a key when memory is full (allkeys-random). Hybridized databases typically use volatile-* policies, which require the presence of expiration values or they behave identically to noeviction. There is another policy that works better for cache data, allkeys-lru. The allkeys-lru policy attempts to remove the less recently used (LRU) keys first in order to make space for the new data added.</p>
<blockquote>
<p>It is also worth to note that setting an expire to a key costs memory, so using a policy like allkeys-lru is more memory efficient since there is no need to set an expire for the key to be evicted under memory pressure.</p>
<p>—Redis Documentation</p>
</blockquote>
<p>Redis uses an approximated LRU algorithm instead of an exact algorithm. What this means is that you can conserve memory in favor of inaccuracy by tuning the number of samples to check with each eviction. Set maxmemory-samples to a low level, say around 5, for “good enough” eviction with a low memory footprint. Lastly, and most importantly, set a maxmemory limit to a comfortable amount of RAM. Without a limit Redis can’t function properly as a LRU cache and will start replying with errors when memory consuming commands start failing.</p>
<h4 id="总结下:-2">总结下:</h4><p>Do set a maxmemory limit.<br>Do use allkeys-lru policies for dedicated cache instances. Let Redis manage key eviction by itself.<br>Do not set expire for keys, it adds additional memory overhead per key.<br>Do tune the precision of the LRU algorithm to favor speed over accuracy. Redis does not pick the best candidate for eviction, it samples a small number of keys and chooses the entry with the oldest access time.</p>
<h2 id="正确使用缓存">正确使用缓存</h2><blockquote>
<p>Because of Redis data structures, the usual pattern used with memcached of destroying objects when the cache is invalidated, to recreate it from the DB later, is a primitive way of using Redis.</p>
<p>—Antirez</p>
</blockquote>
<p>Only storing serialized HTML or JSON as strings, the standard way of caching for web applications, doesn’t fully utilize Redis as a cache. One of the great strengths of Redis over Memcached is the rich set of data structures available. Ordered lists, structured hashes, and sorted sets are particularly useful caching tools only available through Redis. Caching is more than stuffing everything into strings.</p>
<p>Let’s look at the Hash type for a specific example.</p>
<blockquote>
<p>Small hashes are encoded in a very small space, so you should try representing your data using hashes every time it is possible. For instance if you have objects representing users in a web application, instead of using different keys for name, surname, email, password, use a single hash with all the required fields.</p>
<p> —Redis Documentation</p>
</blockquote>
<p>Instead of storing objects as a serialized string you can store the object as fields and values available through a single key. Using a Hash saves web servers the work of fetching an entire serialized value, de-serializing it, updating it, re-serializing it, and finally writing it back to the cache. Eliminating that flow for every minor update pushes the work into Redis and out of your applications, where it is supposed to be.</p>
<h4 id="总结下:-3">总结下:</h4><ul>
<li>Do use the native Redis types wherever possible (list, set, zset, hash).</li>
<li>Do not use the string type for structured data, reach for a hash.<br>Happy optimizing. Go forth and cache!</li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/08/03/upyun-form-api-upload-file/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          upyun文件上传
        
      </div>
    </a>
  
  
    <a href="/2015/07/22/4-most-important-skills/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">软件工程师最重要的4项技能</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="Optimizing-Redis-Usage-For-Caching" data-title="Redis缓存使用优化［译］" data-url="http://yoursite.com/2015/08/02/Optimizing-Redis-Usage-For-Caching/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>



</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 fwwdn
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: undefined,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: undefined
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>